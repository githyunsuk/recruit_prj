<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>민기인력 - 기업 메인</title>
<!-- 카카오지도 -->
<th:block th:replace="~{fragments/external_file :: cdn_block}"></th:block>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<link rel="stylesheet" th:href="@{/corp/mainCss/main_page.css}"/>
<link rel="stylesheet" th:href="@{/corp/jobPosting/jobPostingForm.css}">
<style>

</style>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', () => {
	const userInfo = `[[${user}]]`;
	console.log(userInfo);
	
	//카카오맵 주소 찾기
	document.getElementById("openKakaoMap").addEventListener("click", openKakaoMap);
	
	//포지션 비동기 검색 조회
	getPositionList();
	
	
});

//카카오 주소찾기
function openKakaoMap(){
	new daum.Postcode({
	    oncomplete: function(data) {
	    	document.getElementById("zipcode").value = data.zonecode;
	    	document.getElementById("roadAddress").value = data.roadAddress;
	    }
	}).open();
}


//포지션 ajax로 가져오기
function getPositionList() {
  document.getElementById('positionName').addEventListener('input', function () {
    const keyword = document.getElementById('positionName').value.trim();
    const resultBox = document.querySelector('#resultBox');

    if (keyword === '') {
      resultBox.style.display = 'none';
      return;
    }

    if (keyword.length >= 1) {
      fetch(`/corp/searchPositionByKeyword?keyword=${encodeURIComponent(keyword)}`)
        .then(response => {
          if (!response.ok) {
            throw new Error("서버 오류 발생");
          }
          return response.json();
        })
        .then(data => {
          if (data.length > 0) {
            resultBox.innerHTML = ''; // 기존 내용 비우기
            resultBox.style.display = 'block';

            data.forEach(item => {
              const li = document.createElement('li');
              li.textContent = item.positionName;
              li.classList.add('position-li');
              li.setAttribute('data-position-seq', item.positionSeq);

              li.addEventListener('click', function () { //클릭했을 때
                document.getElementById('positionName').value = item.positionName;
                document.getElementById('positionSeq').value = item.positionSeq;
                resultBox.style.display = 'none';
              });

              resultBox.appendChild(li);
            });
          } else {
        	  document.getElementById('positionSeq').value = '';
            resultBox.innerHTML = '<li>검색 결과 없음</li>';
            resultBox.style.display = 'block';
          }
        })
        .catch(error => {
          console.error("에러 발생:", error);
        });
    }
  });
}

		
</script>
</head>
<body>
<th:block th:replace="~{fragments/corpHeader :: corpHeader}"></th:block>

<div class="job-posting-container">
    <div class="job-posting-header">
        <h1 class="job-posting-title">채용공고 등록</h1>
        <p class="job-posting-subtitle">우수한 인재를 찾아보세요. 정확하고 상세한 정보로 더 많은 지원자를 만나보세요.</p>
    </div>

    <div class="job-posting-main">
        <div class="job-posting-form">
            <form id="frm" th:action="@{/corp/uplaodJobPosting}" method="post" enctype="application/x-www-form-urlencoded">
                
                <!-- 기본 정보 섹션 -->
                <div class="job-posting-section">
                    <h2 class="section-title">📋 기본 정보</h2>
                    
                    <div class="form-group">
                        <label class="form-label required">공고 제목</label>
                        <input type="text" name="postingTitle" class="form-input" placeholder="예: [신입/경력] 백엔드 개발자 모집" required>
                        <div class="form-help">지원자들이 가장 먼저 보게 되는 제목입니다. 명확하고 매력적으로 작성해주세요.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">포지션</label>
                        <input type="text" id="positionName" name="positionSeq" class="form-input" placeholder="포지션 검색" autocomplete="off">
                        <ul id="resultBox" class="list-group position-absolute w-100" style="z-index: 1000;"></ul>
                        <input type="text" id="positionSeq">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">주요 기술스택</label>
                        <input type="text" name="techStack" class="form-input" placeholder="예: Java, Spring Boot, MySQL, AWS">
                        <div class="techStack-list"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">경력 요구사항</label>
                        <select name="expLevel" class="form-select" required>
                            <option value="">경력 수준을 선택하세요</option>
                            <option value="전체">전체 (신입/경력 무관)</option>
                            <option value="신입">신입 (경력 없음)</option>
                            <option value="1년">1년 이상</option>
                            <option value="2년">2년 이상</option>
                            <option value="3년">3년 이상</option>
                            <option value="4년">4년 이상</option>
                            <option value="5년">5년 이상</option>
                            <option value="6년">6년 이상</option>
                            <option value="7년">7년 이상</option>
                            <option value="8년">8년 이상</option>
                            <option value="9년">9년 이상</option>
                            <option value="10년">10년 이상</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">학력 조건</label>
                        <select name="eduLevel" class="form-select" required>
                            <option value="">학력 조건을 선택하세요</option>
                            <option value="무관">학력 무관</option>
                            <option value="고졸이상">고등학교 졸업 이상</option>
                            <option value="초대졸">전문대학 졸업 이상</option>
                            <option value="대졸">대학교 졸업 이상</option>
                            <option value="석사">석사 이상</option>
                            <option value="박사">박사 이상</option>
                        </select>
                    </div>
                </div>

                <!-- 근무 조건 섹션 -->
                <div class="job-posting-section">
                    <h2 class="section-title">💼 근무 조건</h2>
                    
                    <div class="form-group">
                        <label class="form-label required">고용 형태</label>
                        <select name="employType" class="form-select" required>
                            <option value="">고용 형태를 선택하세요</option>
                            <option value="정규">정규직</option>
                            <option value="계약">계약직</option>
                            <option value="인턴">인턴</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">모집 인원</label>
                        <input type="number" name="recruitCnt" class="form-input" placeholder="모집 인원 수" min="1" required>
                        <div class="form-help">채용 예정 인원 수를 입력해주세요.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">연봉</label>
                        <input type="number" name="salary" class="form-input" placeholder="연봉을 입력하세요 (단위: 만원)" min="0">
                        <div class="salary-info">
                            <span>💰 연봉 정보는 더 많은 지원자를 유치하는 데 도움이 됩니다.</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">근무 요일</label>
                        <input type="text" name="workday" class="form-input" placeholder="예: 월~금, 주 5일">
                        <div class="form-help">근무하는 요일을 입력해주세요.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">근무 시간</label>
                        <div class="time-range">
                            <input type="time" name="workStartTime" class="form-input">
                            <span>~</span>
                            <input type="time" name="workEndTime" class="form-input">
                        </div>
                        <div class="form-help">근무 시작 시간과 종료 시간을 설정해주세요.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">계약 기간 (계약직인 경우)</label>
                        <div class="date-range">
                            <input type="date" name="contStartDt" class="form-input">
                            <span>~</span>
                            <input type="date" name="contEndDt" class="form-input">
                        </div>
                        <div class="form-help">계약직인 경우에만 입력해주세요.</div>
                    </div>
                </div>

                <!-- 근무지 정보 섹션 -->
                <div class="job-posting-section">
                    <h2 class="section-title">📍 근무지 정보</h2>
                    
                    <div class="form-group">
                        <label class="form-label required">근무지 주소</label>
                        <div class="zipcode-box">
                            <input type="text" id="zipcode" name="zipcode" class="form-input" placeholder="우편번호" readonly>
                            <button type="button" id="openKakaoMap" class="btn btn-secondary">우편번호 찾기</button>
                        </div>
                        <input type="text" id="roadAddress" name="roadAddress" class="form-input" placeholder="도로명 주소" readonly style="margin-bottom: 10px;">
                        <input type="text" id="detailAddress" name="detailAddress" class="form-input" placeholder="상세 주소 (건물명, 층수 등)">
                        <div class="form-help">정확한 근무지 정보는 지원자들의 지원 결정에 중요한 요소입니다.</div>
                    </div>
                </div>

                <!-- 상세 정보 섹션 -->
                <div class="job-posting-section">
                    <h2 class="section-title">📝 상세 정보</h2>
                    
                    <div class="form-help important">
                        <strong>✨ 작성 가이드</strong><br>
                        • 주요 업무와 책임을 구체적으로 명시해주세요<br>
                        • 필요한 기술과 경험을 명확히 작성해주세요<br>
                        • 회사 문화와 복지 혜택을 상세히 소개해주세요<br>
                        • 성장 기회와 교육 지원에 대해 언급해주세요
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label required">채용공고 상세 내용</label>
                        <textarea name="postingDetail" class="form-textarea" rows="12" placeholder="📌 주요 업무
- 담당하게 될 구체적인 업무 내용을 작성해주세요
- 프로젝트 성격, 사용 기술, 협업 방식 등을 포함해주세요

🎯 자격 요건
- 필수 요구사항을 명확히 작성해주세요
- 우대사항도 함께 작성하시면 좋습니다

🎁 복지 및 혜택
- 급여 외 복리후생을 상세히 작성해주세요
- 교육 지원, 근무 환경, 성장 기회 등을 포함해주세요

📋 채용 절차
- 서류 전형부터 최종 면접까지의 과정을 안내해주세요" required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">공고 마감일</label>
                        <div class="date-range">
                            <div style="flex: 1;">
                                <input type="date" name="postingEndDt" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-help">공고가 게시될 기간을 설정해주세요.</div>
                    </div>
                </div>
            </form>
        </div>

        <div class="job-posting-sidebar">
            <div class="sidebar-card">
                <h3 class="sidebar-title">🚀 공고 등록</h3>
                
                <div class="progress-indicator">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">0% 완료</div>
                </div>

                <button type="submit" form="frm" class="submit-btn">채용공고 등록하기</button>
                
                <div class="preview-section">
                    <button type="button" class="preview-btn">미리보기</button>
                </div>
            </div>

            <div class="sidebar-card tips-section">
                <h4 class="tips-title">💡 작성 팁</h4>
                <ul class="tips-list">
                    <li>구체적이고 명확한 업무 내용 작성</li>
                    <li>필요한 기술스택과 경험 명시</li>
                    <li>회사 문화와 복지 혜택 상세 기재</li>
                    <li>성장 기회와 교육 지원 내용 포함</li>
                    <li>투명한 채용 절차 안내</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('.form-input, .form-textarea, .form-select');
    const progressFill = document.querySelector('.progress-fill');
    const progressText = document.querySelector('.progress-text');
    
    function updateProgress() {
        const requiredFields = document.querySelectorAll('[required]');
        const filledFields = Array.from(requiredFields).filter(input => {
            if (input.type === 'checkbox' || input.type === 'radio') {
                return input.checked;
            }
            return input.value.trim() !== '';
        }).length;
        
        const progress = Math.round((filledFields / requiredFields.length) * 100);
        
        progressFill.style.width = progress + '%';
        progressText.textContent = progress + '% 완료';
        
        // 프로그레스 바 색상 변경
        if (progress < 30) {
            progressFill.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
        } else if (progress < 70) {
            progressFill.style.background = 'linear-gradient(90deg, #f39c12, #e67e22)';
        } else {
            progressFill.style.background = 'linear-gradient(90deg, #667eea, #764ba2)';
        }
    }
    
    // 입력 필드 변경 시 진행률 업데이트
    inputs.forEach(input => {
        input.addEventListener('input', updateProgress);
        input.addEventListener('change', updateProgress);
    });
    
    // 초기 진행률 설정
    updateProgress();
    
    // 미리보기 버튼 이벤트
    document.querySelector('.preview-btn').addEventListener('click', function() {
        const formData = new FormData(document.getElementById('frm'));
        const previewData = {};
        
        for (let [key, value] of formData.entries()) {
            previewData[key] = value;
        }
        
        console.log('미리보기 데이터:', previewData);
        alert('미리보기 기능을 준비중입니다!\n\n현재 입력된 데이터를 콘솔에서 확인할 수 있습니다.');
    });
    
    // 폼 제출 시 유효성 검사
    document.getElementById('frm').addEventListener('submit', function(e) {
        const requiredFields = document.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.style.borderColor = '#e74c3c';
                isValid = false;
            } else {
                field.style.borderColor = '#e1e8ed';
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            alert('필수 항목을 모두 입력해주세요.');
            return;
        }
        
        // 성공 메시지
        alert('채용공고가 성공적으로 등록되었습니다!');
    });
    
    // 연봉 입력 시 단위 표시
    const salaryInput = document.querySelector('input[name="salary"]');
    if (salaryInput) {
        salaryInput.addEventListener('input', function() {
            const value = this.value;
            if (value) {
                const formatted = parseInt(value).toLocaleString();
                this.setAttribute('data-formatted', formatted + '만원');
            }
        });
    }
});
</script>
<th:block th:replace="~{fragments/corpFooter :: corpFooter}"></th:block>
</body>
</html>