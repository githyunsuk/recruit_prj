<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.sist.user.mapper.ReviewMapper">
	
	<select id="selectSearchPosting" parameterType="map" resultType="kr.co.sist.corp.dto.jobPostingDTO">
  SELECT *
  FROM job_posting
  <where>
    <if test="exp_level != null and rating != '전체'">
      exp_level = #{exp_level}
    </if>
    <if test="employ_type != null and employ_type != '전체'">
      employ_type = #{employ_type}
    </if>
    <if test="edu_level != null and edu_level != '전체'">
      edu_level = #{edu_level}
    </if>

    <if test="keyword != null and keyword != ''">
      AND
      <choose>
        <when test="type == 'posting_detail'">
          posting_detail LIKE '%' || #{posting_detail} || '%'
        </when>
        <when test="type == 'posting_title'">
          posting_title LIKE '%' || #{posting_title} || '%'
        </when>
        <when test="type == 'corp_no'">
          corp_no LIKE '%' || #{keyword} || '%'
        </when>
        <otherwise>
          (posting_detail LIKE '%' || #{keyword} || '%'
           OR posting_title LIKE '%' || #{keyword} || '%'
           OR corp_no LIKE '%' || #{keyword} || '%')
        </otherwise>
      </choose>
    </if>
  </where>

  <if test="order == 'start_desc'">
    ORDER BY cont_start_dt DESC
  </if>
  <if test="order == 'start_asc'">
    ORDER BY cont_start_dt ASC
  </if>
  <if test="order == 'end_desc'">
    ORDER BY cont_end_dt DESC
  </if>
  <if test="order == 'end_asc'">
    ORDER BY cont_end_dt ASC
  </if>
	
  OFFSET #{start} ROWS FETCH NEXT #{perPage} ROWS ONLY
</select>


<select id="countSearch"  parameterType="Map" resultType="int">
 	SELECT count(*)
  FROM job_posting
  <where>
    <if test="exp_level != null and rating != '전체'">
      exp_level = #{exp_level}
    </if>
    <if test="employ_type != null and employ_type != '전체'">
      employ_type = #{employ_type}
    </if>
    <if test="edu_level != null and edu_level != '전체'">
      edu_level = #{edu_level}
    </if>

    <if test="keyword != null and keyword != ''">
      AND
      <choose>
        <when test="type == 'posting_detail'">
          posting_detail LIKE '%' || #{posting_detail} || '%'
        </when>
        <when test="type == 'posting_title'">
          posting_title LIKE '%' || #{posting_title} || '%'
        </when>
        <when test="type == 'corp_no'">
          corp_no LIKE '%' || #{keyword} || '%'
        </when>
        <otherwise>
          (posting_detail LIKE '%' || #{keyword} || '%'
           OR posting_title LIKE '%' || #{keyword} || '%'
           OR corp_no LIKE '%' || #{keyword} || '%')
        </otherwise>
      </choose>
    </if>
  </where>
	
</select>

<delete id="deleteReview" parameterType="Map">
	delete from review
	where review_seq in
	<foreach item="id" collection="reviewSeq" open="(" separator="," close=")">
	TO_NUMBER(#{id})
	</foreach>
</delete>


</mapper>